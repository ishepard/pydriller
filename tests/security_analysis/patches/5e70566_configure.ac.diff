@@ -605,6 +605,11 @@ case $host in
     ;;
 esac
 
+curl_cv_cygwin='no'
+case $host_os in
+  cygwin*|msys*) curl_cv_cygwin='yes';;
+esac
+
 AM_CONDITIONAL([HAVE_WINDRES],
   [test "$curl_cv_native_windows" = "yes" && test -n "${RC}"])
 
@@ -4120,6 +4125,10 @@ AC_CHECK_FUNCS([\
   utimes \
 ])
 
+if test "$curl_cv_native_windows" = 'yes' -o "$curl_cv_cygwin" = 'yes'; then
+  AC_CHECK_FUNCS([_setmode])
+fi
+
 if test -z "$ssl_backends"; then
   AC_CHECK_FUNCS([arc4random])
 fi
