@@ -105,7 +105,13 @@ CURLcode Curl_fopen(struct Curl_easy *data, const char *filename,
   *fh = fopen(filename, FOPEN_WRITETEXT);
   if(!*fh)
     goto fail;
-  if(fstat(fileno(*fh), &sb) == -1 || !S_ISREG(sb.st_mode)) {
+  if(
+#ifdef UNDER_CE
+     stat(filename, &sb) == -1
+#else
+     fstat(fileno(*fh), &sb) == -1
+#endif
+     || !S_ISREG(sb.st_mode)) {
     return CURLE_OK;
   }
   fclose(*fh);
